{% comment %}
  Footer Section - Influence Theme
  Premium Features:
  - Mobile accordion collapse
  - Multiple block types (menu, text, newsletter, image, contact, brand)
  - Follow on Shop button
  - Back to top button
  - Layout options
  - Social links, payment icons, localization
{% endcomment %}

{%- liquid
  assign enable_accordion = section.settings.enable_accordion_mobile
  assign layout = section.settings.layout | default: 'auto'
  assign show_back_to_top = section.settings.show_back_to_top
-%}

<footer class="footer section {% render 'color-scheme', scheme: section.settings.color_scheme %}" data-footer>
  <div class="container">
    {%- if section.blocks.size > 0 -%}
      <div class="footer__main footer__main--{{ layout }}">
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'menu' -%}
              <div class="footer__column" {{ block.shopify_attributes }}>
                {%- if enable_accordion -%}
                  <details class="footer__accordion hide-desktop">
                    <summary class="footer__heading footer__heading--accordion">
                      {{ block.settings.heading }}
                      {% render 'icon', icon: 'chevron-down', size: 'sm' %}
                    </summary>
                    <div class="footer__accordion-content">
                      {%- if block.settings.menu != blank -%}
                        <ul class="footer__links">
                          {%- for link in block.settings.menu.links -%}
                            <li>
                              <a href="{{ link.url }}" class="footer__link">{{ link.title }}</a>
                            </li>
                          {%- endfor -%}
                        </ul>
                      {%- endif -%}
                    </div>
                  </details>
                  <div class="hide-mobile hide-tablet">
                    {%- if block.settings.heading != blank -%}
                      <h3 class="footer__heading">{{ block.settings.heading }}</h3>
                    {%- endif -%}
                    {%- if block.settings.menu != blank -%}
                      <ul class="footer__links">
                        {%- for link in block.settings.menu.links -%}
                          <li>
                            <a href="{{ link.url }}" class="footer__link">{{ link.title }}</a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                {%- else -%}
                  {%- if block.settings.heading != blank -%}
                    <h3 class="footer__heading">{{ block.settings.heading }}</h3>
                  {%- endif -%}
                  {%- if block.settings.menu != blank -%}
                    <ul class="footer__links">
                      {%- for link in block.settings.menu.links -%}
                        <li>
                          <a href="{{ link.url }}" class="footer__link">{{ link.title }}</a>
                        </li>
                      {%- endfor -%}
                    </ul>
                  {%- endif -%}
                {%- endif -%}
              </div>

            {%- when 'text' -%}
              <div class="footer__column footer__column--text" {{ block.shopify_attributes }}>
                {%- if enable_accordion and block.settings.heading != blank -%}
                  <details class="footer__accordion hide-desktop">
                    <summary class="footer__heading footer__heading--accordion">
                      {{ block.settings.heading }}
                      {% render 'icon', icon: 'chevron-down', size: 'sm' %}
                    </summary>
                    <div class="footer__accordion-content">
                      {%- if block.settings.text != blank -%}
                        <div class="footer__text rte">{{ block.settings.text }}</div>
                      {%- endif -%}
                    </div>
                  </details>
                  <div class="hide-mobile hide-tablet">
                    <h3 class="footer__heading">{{ block.settings.heading }}</h3>
                    {%- if block.settings.text != blank -%}
                      <div class="footer__text rte">{{ block.settings.text }}</div>
                    {%- endif -%}
                  </div>
                {%- else -%}
                  {%- if block.settings.heading != blank -%}
                    <h3 class="footer__heading">{{ block.settings.heading }}</h3>
                  {%- endif -%}
                  {%- if block.settings.text != blank -%}
                    <div class="footer__text rte">{{ block.settings.text }}</div>
                  {%- endif -%}
                {%- endif -%}
              </div>

            {%- when 'newsletter' -%}
              <div class="footer__column footer__column--newsletter" {{ block.shopify_attributes }}>
                {%- if block.settings.heading != blank -%}
                  <h3 class="footer__heading">{{ block.settings.heading }}</h3>
                {%- endif -%}

                {%- if block.settings.text != blank -%}
                  <p class="footer__newsletter-text">{{ block.settings.text }}</p>
                {%- endif -%}

                {%- form 'customer', class: 'footer__newsletter-form' -%}
                  <input type="hidden" name="contact[tags]" value="newsletter">
                  <div class="footer__newsletter-field">
                    <label for="footer-newsletter-email" class="visually-hidden">
                      {{ 'newsletter.email_placeholder' | t }}
                    </label>
                    <input
                      type="email"
                      name="contact[email]"
                      id="footer-newsletter-email"
                      class="form-input footer__newsletter-input"
                      placeholder="{{ 'newsletter.email_placeholder' | t }}"
                      required
                      autocomplete="email"
                      autocorrect="off"
                      autocapitalize="off"
                    >
                    <button type="submit" class="btn btn--primary footer__newsletter-btn">
                      {{ 'newsletter.subscribe' | t }}
                    </button>
                  </div>
                  {%- if form.posted_successfully? -%}
                    <p class="footer__newsletter-success" role="status">
                      {{ 'newsletter.success' | t }}
                    </p>
                  {%- endif -%}
                  {%- if form.errors -%}
                    <p class="footer__newsletter-error form-error" role="alert">
                      {{ form.errors.translated_fields.email | capitalize }}
                      {{ form.errors.messages.email }}
                    </p>
                  {%- endif -%}
                {%- endform -%}
              </div>

            {%- when 'image' -%}
              <div class="footer__column footer__column--image" {{ block.shopify_attributes }}>
                {%- if block.settings.image != blank -%}
                  {%- assign image_width = block.settings.image_width | default: 150 -%}
                  <a href="{{ block.settings.link | default: routes.root_url }}" class="footer__image-link">
                    {{
                      block.settings.image
                      | image_url: width: image_width
                      | image_tag:
                        loading: 'lazy',
                        width: image_width,
                        class: 'footer__image'
                    }}
                  </a>
                {%- endif -%}
              </div>

            {%- when 'contact' -%}
              <div class="footer__column footer__column--contact" {{ block.shopify_attributes }}>
                {%- if enable_accordion and block.settings.heading != blank -%}
                  <details class="footer__accordion hide-desktop">
                    <summary class="footer__heading footer__heading--accordion">
                      {{ block.settings.heading }}
                      {% render 'icon', icon: 'chevron-down', size: 'sm' %}
                    </summary>
                    <div class="footer__accordion-content">
                      {% render 'footer-contact-content', block: block %}
                    </div>
                  </details>
                  <div class="hide-mobile hide-tablet">
                    <h3 class="footer__heading">{{ block.settings.heading }}</h3>
                    {% render 'footer-contact-content', block: block %}
                  </div>
                {%- else -%}
                  {%- if block.settings.heading != blank -%}
                    <h3 class="footer__heading">{{ block.settings.heading }}</h3>
                  {%- endif -%}
                  {% render 'footer-contact-content', block: block %}
                {%- endif -%}
              </div>

            {%- when 'brand' -%}
              <div class="footer__column footer__column--brand" {{ block.shopify_attributes }}>
                {%- if block.settings.show_logo -%}
                  <a href="{{ routes.root_url }}" class="footer__brand-logo">
                    {%- if settings.logo != blank -%}
                      {{
                        settings.logo
                        | image_url: width: 150
                        | image_tag:
                          loading: 'lazy',
                          class: 'footer__brand-logo-image',
                          alt: settings.logo.alt | default: shop.name
                      }}
                    {%- else -%}
                      <span class="footer__brand-logo-text h4">{{ shop.name }}</span>
                    {%- endif -%}
                  </a>
                {%- endif -%}

                {%- if block.settings.description != blank -%}
                  <div class="footer__brand-description rte">
                    {{ block.settings.description }}
                  </div>
                {%- endif -%}

                {%- if block.settings.show_social -%}
                  {% render 'social-icons', class: 'footer__brand-social' %}
                {%- endif -%}

                {%- if block.settings.show_follow_on_shop -%}
                  {% render 'follow-on-shop', class: 'footer__follow-shop' %}
                {%- endif -%}
              </div>
          {%- endcase -%}
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- comment -%} Social Links (legacy placement) {%- endcomment -%}
    {%- if section.settings.show_social -%}
      <div class="footer__social">
        {% render 'social-icons', class: 'footer__social-list' %}
      </div>
    {%- endif -%}

    {%- comment -%} Follow on Shop (section level) {%- endcomment -%}
    {%- if section.settings.show_follow_on_shop -%}
      <div class="footer__follow-on-shop">
        {% render 'follow-on-shop' %}
      </div>
    {%- endif -%}

    {%- comment -%} Footer Bottom {%- endcomment -%}
    <div class="footer__bottom">
      <div class="footer__bottom-left">
        {%- comment -%} Country/Language Selectors {%- endcomment -%}
        {%- if section.settings.show_country_selector or section.settings.show_language_selector -%}
          <div class="footer__localization">
            {%- form 'localization', class: 'localization-form' -%}
              {%- if section.settings.show_country_selector and localization.available_countries.size > 1 -%}
                <div class="localization-selector" data-localization-selector>
                  <button
                    type="button"
                    class="localization-selector__button"
                    aria-expanded="false"
                    aria-controls="country-selector"
                  >
                    {{ localization.country.name }} ({{ localization.country.currency.iso_code }} {{ localization.country.currency.symbol }})
                    {% render 'icon', icon: 'chevron-up', size: 'sm' %}
                  </button>
                  <div id="country-selector" class="localization-selector__dropdown">
                    {%- for country in localization.available_countries -%}
                      <button
                        type="submit"
                        name="country_code"
                        value="{{ country.iso_code }}"
                        class="localization-selector__option{% if country.iso_code == localization.country.iso_code %} is-selected{% endif %}"
                      >
                        {{ country.name }} ({{ country.currency.iso_code }} {{ country.currency.symbol }})
                      </button>
                    {%- endfor -%}
                  </div>
                </div>
              {%- endif -%}

              {%- if section.settings.show_language_selector and localization.available_languages.size > 1 -%}
                <div class="localization-selector" data-localization-selector>
                  <button
                    type="button"
                    class="localization-selector__button"
                    aria-expanded="false"
                    aria-controls="language-selector"
                  >
                    {{ localization.language.endonym_name | capitalize }}
                    {% render 'icon', icon: 'chevron-up', size: 'sm' %}
                  </button>
                  <div id="language-selector" class="localization-selector__dropdown">
                    {%- for language in localization.available_languages -%}
                      <button
                        type="submit"
                        name="locale_code"
                        value="{{ language.iso_code }}"
                        class="localization-selector__option{% if language.iso_code == localization.language.iso_code %} is-selected{% endif %}"
                      >
                        {{ language.endonym_name | capitalize }}
                      </button>
                    {%- endfor -%}
                  </div>
                </div>
              {%- endif -%}
            {%- endform -%}
          </div>
        {%- endif -%}

        {%- comment -%} Copyright {%- endcomment -%}
        <div class="footer__copyright">
          <span>&copy; {{ 'now' | date: '%Y' }} {{ shop.name }}</span>
          <span>{{ powered_by_link }}</span>
        </div>
      </div>

      {%- comment -%} Payment Icons {%- endcomment -%}
      {%- if section.settings.show_payment_icons -%}
        <div class="footer__payment-icons">
          {%- for type in shop.enabled_payment_types -%}
            {{ type | payment_type_svg_tag: class: 'footer__payment-icon' }}
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</footer>

{%- comment -%} Back to Top Button {%- endcomment -%}
{%- if show_back_to_top -%}
  <button
    type="button"
    class="back-to-top"
    aria-label="{{ 'accessibility.back_to_top' | t }}"
    data-back-to-top
    hidden
  >
    {% render 'icon', icon: 'chevron-up' %}
  </button>
{%- endif -%}

<script>
  // Localization selector toggle
  document.querySelectorAll('[data-localization-selector]').forEach(selector => {
    const button = selector.querySelector('button');

    button.addEventListener('click', () => {
      const isOpen = selector.classList.contains('is-open');
      document.querySelectorAll('[data-localization-selector]').forEach(s => {
        s.classList.remove('is-open');
        s.querySelector('button').setAttribute('aria-expanded', 'false');
      });
      if (!isOpen) {
        selector.classList.add('is-open');
        button.setAttribute('aria-expanded', 'true');
      }
    });

    document.addEventListener('click', (e) => {
      if (!selector.contains(e.target)) {
        selector.classList.remove('is-open');
        button.setAttribute('aria-expanded', 'false');
      }
    });
  });

  // Back to top button
  const backToTopBtn = document.querySelector('[data-back-to-top]');
  if (backToTopBtn) {
    const showThreshold = 400;

    function toggleBackToTop() {
      if (window.scrollY > showThreshold) {
        backToTopBtn.hidden = false;
        backToTopBtn.classList.add('is-visible');
      } else {
        backToTopBtn.classList.remove('is-visible');
        setTimeout(() => {
          if (!backToTopBtn.classList.contains('is-visible')) {
            backToTopBtn.hidden = true;
          }
        }, 300);
      }
    }

    window.addEventListener('scroll', toggleBackToTop, { passive: true });

    backToTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }
</script>

{% schema %}
{
  "name": "t:sections.footer.name",
  "class": "section-footer",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:labels.color_scheme",
      "default": "scheme_1"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "t:sections.footer.settings.layout.label",
      "options": [
        {
          "value": "auto",
          "label": "t:sections.footer.settings.layout.options.auto"
        },
        {
          "value": "equal",
          "label": "t:sections.footer.settings.layout.options.equal"
        },
        {
          "value": "first-wide",
          "label": "t:sections.footer.settings.layout.options.first_wide"
        },
        {
          "value": "last-wide",
          "label": "t:sections.footer.settings.layout.options.last_wide"
        }
      ],
      "default": "auto"
    },
    {
      "type": "checkbox",
      "id": "enable_accordion_mobile",
      "label": "t:sections.footer.settings.accordion.label",
      "info": "t:sections.footer.settings.accordion.info",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.footer.settings.social.header"
    },
    {
      "type": "checkbox",
      "id": "show_social",
      "label": "t:sections.footer.settings.show_social.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_follow_on_shop",
      "label": "t:sections.footer.settings.follow_on_shop.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.footer.settings.localization.header"
    },
    {
      "type": "checkbox",
      "id": "show_country_selector",
      "label": "t:sections.footer.settings.show_country_selector.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_language_selector",
      "label": "t:sections.footer.settings.show_language_selector.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.footer.settings.bottom.header"
    },
    {
      "type": "checkbox",
      "id": "show_payment_icons",
      "label": "t:sections.footer.settings.show_payment_icons.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_back_to_top",
      "label": "t:sections.footer.settings.back_to_top.label",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "menu",
      "name": "t:sections.footer.blocks.menu.name",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.footer.blocks.menu.settings.heading.label",
          "default": "Quick links"
        },
        {
          "type": "link_list",
          "id": "menu",
          "label": "t:sections.footer.blocks.menu.settings.menu.label",
          "default": "footer"
        }
      ]
    },
    {
      "type": "text",
      "name": "t:sections.footer.blocks.text.name",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.footer.blocks.text.settings.heading.label",
          "default": "About us"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "t:sections.footer.blocks.text.settings.text.label",
          "default": "<p>Share information about your brand with your customers.</p>"
        }
      ]
    },
    {
      "type": "newsletter",
      "name": "t:sections.footer.blocks.newsletter.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.footer.blocks.newsletter.settings.heading.label",
          "default": "Newsletter"
        },
        {
          "type": "text",
          "id": "text",
          "label": "t:sections.footer.blocks.newsletter.settings.text.label",
          "default": "Subscribe to receive updates, access to exclusive deals, and more."
        }
      ]
    },
    {
      "type": "image",
      "name": "t:sections.footer.blocks.image.name",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.footer.blocks.image.settings.image.label"
        },
        {
          "type": "url",
          "id": "link",
          "label": "t:sections.footer.blocks.image.settings.link.label"
        },
        {
          "type": "range",
          "id": "image_width",
          "min": 50,
          "max": 200,
          "step": 10,
          "unit": "px",
          "default": 150,
          "label": "t:sections.footer.blocks.image.settings.width.label"
        }
      ]
    },
    {
      "type": "contact",
      "name": "t:sections.footer.blocks.contact.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.footer.blocks.contact.settings.heading.label",
          "default": "Contact us"
        },
        {
          "type": "text",
          "id": "phone",
          "label": "t:sections.footer.blocks.contact.settings.phone.label"
        },
        {
          "type": "text",
          "id": "email",
          "label": "t:sections.footer.blocks.contact.settings.email.label"
        },
        {
          "type": "textarea",
          "id": "address",
          "label": "t:sections.footer.blocks.contact.settings.address.label"
        },
        {
          "type": "text",
          "id": "hours",
          "label": "t:sections.footer.blocks.contact.settings.hours.label"
        }
      ]
    },
    {
      "type": "brand",
      "name": "t:sections.footer.blocks.brand.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_logo",
          "label": "t:sections.footer.blocks.brand.settings.logo.label",
          "default": true
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "t:sections.footer.blocks.brand.settings.description.label"
        },
        {
          "type": "checkbox",
          "id": "show_social",
          "label": "t:sections.footer.blocks.brand.settings.social.label",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_follow_on_shop",
          "label": "t:sections.footer.settings.follow_on_shop.label",
          "default": false
        }
      ]
    }
  ],
  "max_blocks": 6,
  "default": {
    "blocks": [
      {
        "type": "brand",
        "settings": {
          "show_logo": true,
          "show_social": true
        }
      },
      {
        "type": "menu",
        "settings": {
          "heading": "Shop",
          "menu": "main-menu"
        }
      },
      {
        "type": "menu",
        "settings": {
          "heading": "Help",
          "menu": "footer"
        }
      },
      {
        "type": "newsletter",
        "settings": {
          "heading": "Newsletter",
          "text": "Subscribe to receive updates and exclusive offers."
        }
      }
    ]
  }
}
{% endschema %}
