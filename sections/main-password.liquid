{% comment %}
  Main Password Section - Influence Theme
  Password page for store in password mode
{% endcomment %}

<section class="main-password section {% render 'color-scheme', scheme: section.settings.color_scheme %}">
  <div class="container">
    <div class="main-password__content text-center">
      {%- if section.settings.logo != blank -%}
        <div class="main-password__logo">
          {{
            section.settings.logo
            | image_url: width: 400
            | image_tag:
              loading: 'eager',
              width: section.settings.logo_width,
              class: 'main-password__logo-image'
          }}
        </div>
      {%- else -%}
        <h1 class="main-password__shop-name h1">{{ shop.name }}</h1>
      {%- endif -%}

      {%- if section.settings.heading != blank -%}
        <h2 class="main-password__heading h2">{{ section.settings.heading }}</h2>
      {%- endif -%}

      {%- if section.settings.text != blank -%}
        <div class="main-password__text rte">
          {{ section.settings.text }}
        </div>
      {%- endif -%}

      {%- comment -%} Newsletter Signup {%- endcomment -%}
      {%- if section.settings.show_newsletter -%}
        <div class="main-password__newsletter">
          {%- form 'customer', class: 'password-newsletter-form' -%}
            <input type="hidden" name="contact[tags]" value="password-page">

            {%- if form.posted_successfully? -%}
              <p class="form-message form-message--success">
                {{ 'newsletter.success' | t }}
              </p>
            {%- else -%}
              {%- if form.errors -%}
                <p class="form-message form-message--error">
                  {{ form.errors.messages['email'] }}
                </p>
              {%- endif -%}

              <div class="password-newsletter-form__field">
                <label for="PasswordEmail" class="visually-hidden">{{ 'newsletter.email_placeholder' | t }}</label>
                <input
                  type="email"
                  id="PasswordEmail"
                  name="contact[email]"
                  class="form-input"
                  placeholder="{{ 'newsletter.email_placeholder' | t }}"
                  required
                  autocomplete="email"
                >
                <button type="submit" class="btn btn--primary">
                  {{ 'newsletter.subscribe' | t }}
                </button>
              </div>
            {%- endif -%}
          {%- endform -%}
        </div>
      {%- endif -%}

      {%- comment -%} Password Entry {%- endcomment -%}
      <div class="main-password__login">
        <button type="button" class="main-password__login-btn link" data-password-toggle>
          {{ 'password.enter_password' | t }}
        </button>

        <div class="main-password__form" data-password-form hidden>
          {%- form 'storefront_password', class: 'password-form' -%}
            {%- if form.errors -%}
              <p class="form-message form-message--error">
                {{ 'password.wrong_password' | t }}
              </p>
            {%- endif -%}

            <div class="password-form__field">
              <label for="Password" class="visually-hidden">{{ 'password.password' | t }}</label>
              <input
                type="password"
                id="Password"
                name="password"
                class="form-input"
                placeholder="{{ 'password.password' | t }}"
                required
              >
              <button type="submit" class="btn btn--primary">
                {{ 'password.submit' | t }}
              </button>
            </div>
          {%- endform -%}
        </div>
      </div>

      {%- comment -%} Social Links {%- endcomment -%}
      {%- if section.settings.show_social -%}
        <div class="main-password__social">
          {%- if settings.social_facebook_link != blank -%}
            <a href="{{ settings.social_facebook_link }}" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
              {% render 'icon', icon: 'facebook' %}
            </a>
          {%- endif -%}
          {%- if settings.social_instagram_link != blank -%}
            <a href="{{ settings.social_instagram_link }}" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
              {% render 'icon', icon: 'instagram' %}
            </a>
          {%- endif -%}
          {%- if settings.social_twitter_link != blank -%}
            <a href="{{ settings.social_twitter_link }}" target="_blank" rel="noopener noreferrer" aria-label="Twitter">
              {% render 'icon', icon: 'twitter' %}
            </a>
          {%- endif -%}
          {%- if settings.social_pinterest_link != blank -%}
            <a href="{{ settings.social_pinterest_link }}" target="_blank" rel="noopener noreferrer" aria-label="Pinterest">
              {% render 'icon', icon: 'pinterest' %}
            </a>
          {%- endif -%}
          {%- if settings.social_tiktok_link != blank -%}
            <a href="{{ settings.social_tiktok_link }}" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
              {% render 'icon', icon: 'tiktok' %}
            </a>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<script>
(function() {
  const toggleBtn = document.querySelector('[data-password-toggle]');
  const passwordForm = document.querySelector('[data-password-form]');

  if (toggleBtn && passwordForm) {
    toggleBtn.addEventListener('click', () => {
      passwordForm.hidden = !passwordForm.hidden;
      if (!passwordForm.hidden) {
        passwordForm.querySelector('input[type="password"]').focus();
      }
    });
  }
})();
</script>

{% schema %}
{
  "name": "t:sections.main_password.name",
  "tag": "section",
  "class": "section-main-password",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "t:sections.main_password.settings.logo.label"
    },
    {
      "type": "range",
      "id": "logo_width",
      "label": "t:sections.main_password.settings.logo_width.label",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "default": 150
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:labels.heading",
      "default": "Opening soon"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "t:labels.text",
      "default": "<p>Be the first to know when we launch. Subscribe to our newsletter for exclusive updates.</p>"
    },
    {
      "type": "checkbox",
      "id": "show_newsletter",
      "label": "t:sections.main_password.settings.show_newsletter.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_social",
      "label": "t:sections.main_password.settings.show_social.label",
      "default": true
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "t:labels.color_scheme",
      "options": [
        { "value": "scheme-1", "label": "t:options.color_scheme.scheme_1" },
        { "value": "scheme-2", "label": "t:options.color_scheme.scheme_2" }
      ],
      "default": "scheme-1"
    }
  ]
}
{% endschema %}
